<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ماشین‌حساب پیشرفته قیمت تمام‌شده آب در مشهد</title>
  <link rel="stylesheet" href="../assets/tailwind.css">
  <link rel="stylesheet" href="../assets/styles.css">
  <link rel="stylesheet" href="../assets/fonts.css">
  <link rel="stylesheet" href="/assets/footer.css">
  <style>
    .input{ @apply mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-300; }
    .range{ @apply mt-1 w-full; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 tabular-nums">
  <main class="container mx-auto max-w-7xl px-4 py-6">
    <h1 class="text-center text-2xl md:text-3xl font-bold text-sky-700 mb-4">ماشین‌حساب پیشرفته قیمت تمام‌شده آب در مشهد</h1>
    <div class="grid gap-6 lg:grid-cols-3 items-start">
      <!-- Left (outputs) -->
      <section class="lg:col-span-2 space-y-4" id="outputs-col">
        <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-4 md:p-5 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <!-- KPI سبز -->
            <div id="kpi-consumer" class="rounded-lg border bg-green-50 p-3 text-center">
              <div class="text-xs text-slate-600 mb-1">قیمت نهایی برای مصرف‌کننده</div>
              <div class="text-3xl md:text-4xl font-extrabold text-emerald-600" data-out="consumer_price">—</div>
              <div class="text-[11px] text-slate-500">بر مترمکعب</div>
            </div>
            <!-- KPI صورتی -->
            <div id="kpi-true" class="rounded-lg border bg-rose-50 p-3 text-center">
              <div class="text-xs text-slate-600 mb-1">قیمت تمام‌شده واقعی</div>
              <div class="text-3xl md:text-4xl font-extrabold text-rose-600" data-out="true_cost">—</div>
              <div class="text-[11px] text-slate-500">بر مترمکعب</div>
            </div>
          </div>

          <!-- جدول سهم عوامل -->
          <div>
            <h2 class="text-sm font-semibold mb-2">جدول سهم هر متغیر</h2>
            <table class="w-full text-sm border-separate [border-spacing:0]">
              <thead class="text-slate-500">
                <tr><th class="text-right py-2">آیتم</th><th class="text-right py-2">هزینه</th><th class="text-left py-2">درصد</th></tr>
              </thead>
              <tbody id="share-table" class="align-top"></tbody>
            </table>
          </div>

          <!-- دونات -->
          <div>
            <h2 class="text-sm font-semibold mb-2">نمودار دونات سهم عوامل</h2>
            <div id="chart-wrap" class="mx-auto max-w-[360px] md:max-w-[420px] h-64 md:h-72">
              <canvas id="share-donut"></canvas>
            </div>
          </div>

          <!-- تحلیل حساسیت -->
          <div>
            <h2 class="text-sm font-semibold mb-2">تحلیل حساسیت (اثر تغییر ۱۰٪ در ورودی‌ها)</h2>
            <ul id="sensitivity" class="text-sm space-y-1 list-disc pr-4"></ul>
          </div>

          <!-- جمع‌بندی -->
          <div>
            <h2 class="text-sm font-semibold mb-2">جمع‌بندی تحلیل</h2>
            <div id="summary" class="text-sm leading-7 text-slate-700 bg-slate-50 border border-slate-200 rounded-lg p-3"></div>
          </div>
        </div>
      </section>

      <!-- Right (inputs) -->
      <aside class="lg:col-span-1 space-y-4" id="inputs-col">
        <!-- کارت ۱ -->
        <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-4 md:p-5 space-y-3">
          <h3 class="font-semibold text-slate-700">۱. عوامل فنی و زیربنایی</h3>
          <label class="text-sm">هزینه تولید هر مترمکعب (تومان)
            <input type="number" class="input" data-input="cost_production">
          </label>
          <label class="text-sm">هزینه انرژی (تومان)
            <input type="number" class="input" data-input="cost_energy">
          </label>
          <label class="text-sm">درصد تلفات شبکه (%)
            <input type="range" min="0" max="60" step="1" class="range" data-input="loss_pct">
          </label>
        </div>

        <!-- کارت ۲ -->
        <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-4 md:p-5 space-y-3">
          <h3 class="font-semibold text-slate-700">۲. عوامل اقتصادی و مدیریتی</h3>
          <label class="text-sm">هزینه نگهداری و تعمیرات (تومان)
            <input type="number" class="input" data-input="cost_om">
          </label>
          <label class="text-sm">درصد یارانه پنهان (%)
            <input type="range" min="0" max="100" step="1" class="range" data-input="subsidy_pct">
          </label>
        </div>

        <!-- کارت ۳ -->
        <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-4 md:p-5 space-y-3">
          <h3 class="font-semibold text-slate-700">۳. محیطی و اجتماعی</h3>
          <label class="text-sm">درصد تأثیر قطعی برق (%)
            <input type="range" min="0" max="60" step="1" class="range" data-input="blackout_pct">
          </label>
        </div>
      </aside>
    </div>
  </main>

  <script src="../assets/libs/chart.umd.min.js"></script>
  <script defer src="../assets/numfmt.js"></script>
  <script defer src="../assets/water-init.js"></script>
  <script defer src="../assets/water-cost-calculator.js"></script>
  <script defer src="/assets/footer.js"></script>
</body>
</html>

