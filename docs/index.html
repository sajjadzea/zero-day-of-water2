<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wesh360</title>
    <link rel="stylesheet" href="assets/tailwind.css" />
    <link rel="stylesheet" href="fonts/fonts.css" />
    <link rel="stylesheet" href="page/landing/landing.css" />
    <script src="assets/persian-digits.js" defer></script>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-6">
  <img src="page/landing/logo2.jfif" alt="Ù„ÙˆÚ¯ÙˆÛŒ wesh360" class="logo-fixed" />
  <main class="w-full text-center space-y-12">
    <h1 class="welcome-text">Ø¨Ù‡ wesh360 Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h1>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 max-w-3xl mx-auto">
        <a href="water/" data-sector="water" class="landing-option bg-white rounded-xl p-8 flex flex-col items-center text-lg font-bold text-slate-700">
          <span class="text-5xl mb-4">ğŸ’§</span>
          Ø¢Ø¨
        </a>
        <a href="electricity/" data-sector="electricity" class="landing-option bg-white rounded-xl p-8 flex flex-col items-center text-lg font-bold text-slate-700">
          <span class="text-5xl mb-4">âš¡</span>
          Ø¨Ø±Ù‚
        </a>
        <a href="gas/" data-sector="gas" class="landing-option bg-white rounded-xl p-8 flex flex-col items-center text-lg font-bold text-slate-700">
          <span class="text-5xl mb-4">ğŸ›¢</span>
          Ú¯Ø§Ø² Ùˆ ÙØ±Ø¢ÙˆØ±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙØªÛŒ
        </a>
      </div>
      <a id="quick-entry" href="#" class="hidden landing-option bg-blue-600 text-white rounded-xl py-4 px-8 inline-block font-bold"></a>
  </main>
  <div id="curtain" class="curtain hidden"><div class="curtain-half left"></div><div class="curtain-half right"></div></div>
  <script>
  (function () {
    function parseMaxTransitionMs(els) {
      let maxMs = 0;
      els.forEach(el => {
        const cs = getComputedStyle(el);
        const durs = cs.transitionDuration.split(',').map(s => parseFloat(s) || 0);
        const dels = cs.transitionDelay.split(',').map(s => parseFloat(s) || 0);
        const n = Math.max(durs.length, dels.length);
        for (let i = 0; i < n; i++) {
          const dur = (durs[i] || durs[durs.length - 1] || 0) * 1000;
          const del = (dels[i] || dels[dels.length - 1] || 0) * 1000;
          maxMs = Math.max(maxMs, dur + del);
        }
      });
      return Math.max(400, maxMs);
    }

    function animatedNavigate(e) {
      e.preventDefault();
      const el = e.currentTarget;
      const href = el.href;
      const sector = el.getAttribute('data-sector');
      if (sector) localStorage.setItem('sector', sector);

      const curtain = document.getElementById('curtain');
      const halves = curtain ? curtain.querySelectorAll('.curtain-half') : [];
      if (!curtain || !halves.length) {
        window.location.href = href;
        return;
      }

      curtain.classList.remove('hidden');
      curtain.offsetWidth;
      curtain.classList.add('open');

      let remaining = halves.length;
      let navigated = false;

      function go() {
        if (navigated) return;
        navigated = true;
        window.location.assign(href);
      }

      const fallbackMs = parseMaxTransitionMs(halves) + 150;
      const timeoutId = setTimeout(go, fallbackMs);

      halves.forEach(half => {
        half.addEventListener('transitionend', function () {
          if (navigated) return;
          if (--remaining === 0) {
            clearTimeout(timeoutId);
            go();
          }
        }, { once: true });
      });
    }

    document.querySelectorAll('[data-sector]').forEach(el => {
      el.removeEventListener('click', animatedNavigate);
      el.addEventListener('click', animatedNavigate);
    });

    const sector = localStorage.getItem('sector');
    if (sector) {
      const names = { water: 'Ø¢Ø¨', electricity: 'Ø¨Ø±Ù‚', gas: 'Ú¯Ø§Ø² Ùˆ ÙØ±Ø¢ÙˆØ±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙØªÛŒ' };
      const quick = document.getElementById('quick-entry');
      if (quick) {
        quick.href = sector + '/';
        quick.textContent = 'ÙˆØ±ÙˆØ¯ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ ' + (names[sector] || sector);
        quick.setAttribute('data-sector', sector);
        quick.classList.remove('hidden');
        quick.removeEventListener('click', animatedNavigate);
        quick.addEventListener('click', animatedNavigate);
      }
    }
  })();
  </script>
  <script>
  (function () {
    const params = new URLSearchParams(location.search);
    if (params.get('debug-curtain') !== '1') return;
    if (!document.getElementById('curtain') || !document.querySelector('[data-sector]')) return;

    const curtain = document.getElementById('curtain');
    const halves = Array.from(curtain.querySelectorAll('.curtain-half'));
    console.log('Curtain present:', !!curtain);
    console.log('Curtain halves:', halves.length);
    if (!curtain || !halves.length) return;

    halves.forEach((half, i) => {
      const cs = getComputedStyle(half);
      console.log(`Half ${i} computed styles`, {
        'transition-duration': cs.transitionDuration,
        'transition-delay': cs.transitionDelay,
        transform: cs.transform,
      });
      ['transitionend', 'transitioncancel', 'animationend'].forEach(ev => {
        half.addEventListener(ev, e => {
          console.log(`Half ${i} ${ev}`, { elapsedTime: e.elapsedTime });
        });
      });
    });

    let prev = curtain.className;
    console.log('Curtain initial classes:', prev);
    const mo = new MutationObserver(() => {
      const curr = curtain.className;
      if (!prev.includes('open') && curr.includes('open')) {
        console.log('Curtain classes before .open:', prev);
        console.log('Curtain classes after .open:', curr);
      } else {
        console.log('Curtain class change:', curr);
      }
      prev = curr;
    });
    mo.observe(curtain, { attributes: true });

    function parseMaxTransitionMs(els) {
      let maxMs = 0;
      els.forEach(el => {
        const cs = getComputedStyle(el);
        const durs = cs.transitionDuration.split(',').map(s => parseFloat(s) || 0);
        const dels = cs.transitionDelay.split(',').map(s => parseFloat(s) || 0);
        const n = Math.max(durs.length, dels.length);
        for (let i = 0; i < n; i++) {
          const dur = (durs[i] || durs[durs.length - 1] || 0) * 1000;
          const del = (dels[i] || dels[dels.length - 1] || 0) * 1000;
          maxMs = Math.max(maxMs, dur + del);
        }
      });
      return Math.max(400, maxMs);
    }

    console.log('Max transition time (ms):', parseMaxTransitionMs(halves));
  })();
  </script>
</body>
</html>
